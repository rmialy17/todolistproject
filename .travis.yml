language: php

matrix:
    include:
        - php: 7.4
        #   env: BLACKFIRE=on

services:
  - mysql         

sudo: false

cache:
    - $HOME/.composer/cache/files

# before_install:
#     - |
#         if [[ "$BLACKFIRE" = "on" ]]; then
#             openssl aes-256-cbc -K $encrypted_16ab3ffdcd52_key -iv $encrypted_16ab3ffdcd52_iv -in .blackfire.travis.ini.enc -out ~/.blackfire.ini -d
#             curl -L https://blackfire.io/api/v1/releases/agent/linux/amd64 | tar zxpf -
#             chmod 755 agent && ./agent --config=~/.blackfire.ini --socket=unix:///tmp/blackfire.sock &
#         fi

# install:
#     - travis_retry composer install
before_install:
    # - mysql -u root -e 'CREATE DATABASE todolistproject_test;' < travis.sql
    - mysql -u root -e 'CREATE DATABASE todolistproject_test;'
    # - mysql -u root < tests/travis.sql
#   - mysql -e 'CREATE DATABASE symfony;
    # - mysql -e 'CREATE DATABASE IF NOT EXISTS test;

before_script:
    #- composer self-update
    - composer install
env:
    # - KERNEL_CLASS='App\Kernel'
    # - APP_SECRET='$ecretf0rt3st'
    # - SYMFONY_DEPRECATIONS_HELPER=999999
    # - PANTHER_APP_ENV=panther
    # - PANTHER_ERROR_SCREENSHOT_DIR=./var/error-screenshots
    # - mysql -u root -e 'CREATE DATABASE todolistproject_test;'
    # - mysql -e 'USE todolistproject_test; create table user'
    # - php bin/console doctrine:schema:update --force
    # - php bin/console doctrine:fixtures:load -n
    # - phpenv config-rm xdebug.ini || true
    # - |
    #     if [[ "$BLACKFIRE" = "on" ]]; then
    #         curl -L https://blackfire.io/api/v2/releases/probe/php/linux/amd64/$(php -r "echo PHP_MAJOR_VERSION . PHP_MINOR_VERSION;")-zts | tar zxpf -
    #         echo "extension=$(pwd)/$(ls blackfire-*.so | tr -d '[[:space:]]')" > ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/blackfire.ini
    #         echo "blackfire.agent_socket=unix:///tmp/blackfire.sock" >> ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/blackfire.ini
    #     fi

script:
    - travis.sql
    - vendor/bin/phpunit